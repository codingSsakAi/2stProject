# 자동차보험 추천 시스템 프로젝트

---

## 1. 프로젝트 개요

### 📋 프로젝트명
**LLM-RAG 기반 Django 자동차보험 추천 플랫폼 (LangChain & ML 통합)**

### 🔑 핵심 기술 스택
- **LLM (Large Language Model)**: GPT 기반 자연어 처리 및 상담
- **LangChain**: LLM 애플리케이션 개발 프레임워크
- **RAG (Retrieval-Augmented Generation)**: 정보 검색 증강 생성
- **Django**: 웹 애플리케이션 프레임워크
- **ML (Machine Learning)**: 개인화 추천 알고리즘

### 👥 프로젝트 팀원 (총 5명)
- **김진경** - 프로젝트 매니저 / 백엔드 개발
- **장선호** - 데이터 분석 / AI 모델링
- **김민준** - 프론트엔드 개발 / UI/UX
- **한창희** - 데이터 수집 / 크롤링
- **유성미** - 데이터베이스 설계 / API 개발

---

## 2. 주제 선정 및 목적

### 🎯 주제 선정 배경
- **기술적 도전**: **LLM + RAG + ML** 융합 시스템 구현
- **고객 Pain Point**: 복잡한 자동차보험 상품 비교의 어려움
- **시장 필요성**: **Django 기반** 확장 가능한 개인 맞춤형 보험 추천 서비스
- **AI 기술 활용**: **LangChain**을 통한 실용적 LLM 애플리케이션 개발

### 📌 프로젝트 목적
1. **LLM 기반 개인화 상담**: GPT 모델을 활용한 자연스러운 보험 상담
2. **RAG 시스템 구현**: 보험 약관 데이터베이스와 연동된 정확한 정보 제공
3. **ML 추천 알고리즘**: 사용자 프로필 기반 머신러닝 추천 시스템
4. **Django 웹 플랫폼**: 확장 가능하고 안정적인 웹 서비스 구축
5. **LangChain 통합**: LLM과 외부 도구의 효율적 연동

---

## 3. 데이터 수집 및 분석

### 📊 데이터 수집 대상
**11개 주요 손해보험사 자동차보험 이용약관**
- 롯데손해보험
- 메리츠화재
- 삼성화재
- 캐롯손해보험주식회사
- 하나손해보험
- 현대해상
- 흥국화재
- AXA손해보험주식회사
- DB손해보험
- KB손해보험
- MG손해보험

### 🔍 데이터 수집 방법
- **웹 크롤링**: 각 보험사 공식 홈페이지 약관 데이터 수집
- **구조화 작업**: PDF/HTML 문서를 구조화된 데이터로 변환
- **데이터 검증**: 수집된 약관의 정확성 및 최신성 검증

### 📈 데이터 전처리
- **텍스트 정제**: 불필요한 서식 제거 및 표준화
- **벡터화**: 약관 텍스트의 임베딩 생성
- **인덱싱**: Pinecone을 활용한 벡터 데이터베이스 구축 (보험사별 인덱스 관리 및 관리자 기능과 연동)

---

## 4. 기술 스택 및 개발환경

### 🐍 Backend & AI Core Stack
- **Python 3.10**: 메인 개발 언어
- **Mock Server**: 자체 구축한 보험료 계산 Mock API 서버
- **LLM (Large Language Model)**: OpenAI GPT-4/3.5 모델 활용
- **LangChain**: LLM 애플리케이션 개발 프레임워크
  - LLM Chain 구성 및 관리
  - Memory 기능을 통한 대화 맥락 유지
  - Tool 연동 (Mock API, Database 등)
- **RAG (Retrieval-Augmented Generation)**: 
  - 문서 검색 및 컨텍스트 증강
  - 벡터 임베딩 기반 유사도 검색
- **Django**: RESTful API 및 웹 프레임워크
- **ML (Machine Learning)**: 
  - Scikit-learn: 추천 알고리즘
  - 사용자 행동 패턴 분석
  - 개인화 점수 산정 모델

### 🗄️ Database & Vector Store
- **MySQL**: 관계형 데이터베이스 (사용자, 보험상품 데이터)
- **Pinecone**: 벡터 데이터베이스 (RAG 시스템) - 보험사별 약관 인덱스 및 관리자 업로드 기능 지원
- **PythonAnywhere**: 클라우드 호스팅

### 🔧 Data Processing & ML
- **easycodefpy**: CODEF API 연동 및 보험료 데이터 처리
- **Pandas**: 사용자-보험상품 매트릭스 데이터 처리
- **NumPy**: 유사도 계산 및 벡터 연산
- **Scikit-learn**: 
  - 협업 필터링 알고리즘 (NearestNeighbors)
  - 코사인 유사도 계산 (cosine_similarity)
  - 차원 축소 (PCA, SVD)
- **NLTK/spaCy**: 사용자 피드백 텍스트 분석 (필요시)

### 🎨 Frontend
- **Django Templates**: 서버 사이드 렌더링
- **Bootstrap**: 반응형 웹 디자인
- **JavaScript**: 동적 웹 인터페이스 및 AJAX
- **Chart.js**: 데이터 시각화

---

## 5. API 및 외부 서비스 연동

### 💰 Mock 서버 기반 보험료 계산 시스템
- **Mock 서버 선택 배경**: 
  - CODEF API 정식 서비스 신청 시 사업자등록증 필요
  - 개발 초기 단계에서 외부 API 의존성 제거
  - 팀원 모두가 동일한 환경에서 개발 가능
  - API 호출 비용 및 제한 없는 무제한 테스트
- **Mock 데이터 설계**: 실제 보험료 계산 로직과 유사한 알고리즘 구현
- **환경별 전환 지원**: 개발용 Mock → 운영용 실제 API 쉬운 전환
- **완전한 기능 구현**: Mock 환경에서도 모든 시스템 기능 완벽 구현

### 🔄 Mock 서버 vs 실제 API 전환 구조
```python
# 환경변수로 간단한 전환
USE_MOCK_API = True   # 개발환경 (Mock 서버)
USE_MOCK_API = False  # 운영환경 (실제 CODEF API)
```

## 💡 Mock 서버 선택 배경 및 구현 전략

### 🚫 실제 API 사용의 제약사항
- **CODEF API 정식 이용**: 사업자등록증, 법인 설립 필요
- **개발팀 접근성**: 학생 신분으로 정식 서비스 신청 어려움
- **비용 문제**: API 호출당 과금으로 개발 비용 부담
- **개발 속도**: 외부 API 승인 대기시간으로 인한 개발 지연

### ✅ Mock 서버 선택의 장점
- **독립적 개발 환경**: 외부 API 의존성 없는 완전한 개발 진행
- **실제 로직 구현**: 11개 보험사의 실제 요율 계산 방식 시뮬레이션
- **무제한 테스트**: API 호출 제한 없는 자유로운 개발 및 테스트
- **팀 협업 최적화**: 모든 팀원이 동일한 환경에서 개발 가능
- **완벽한 시스템 구현**: Mock 환경에서도 실제 서비스와 동일한 기능 구현

### 🎯 Mock 서버 구현 수준
- **실제 보험사 11곳 데이터**: 삼성화재, 현대해상, KB손해보험 등 실제 보험사 요율 반영
- **복합 요인 계산**: 나이, 성별, 지역, 운전경력, 사고이력, 차종 등 종합 고려
- **시장 분석 데이터**: 평균 보험료, 가성비 분석, 시장 동향 정보 제공
- **확장 가능한 구조**: 추후 실제 API 연동 시 최소한의 코드 변경으로 전환 가능

### 🔐 API 보안
- **API 키 관리**: 환경변수를 통한 안전한 키 관리
- **Rate Limiting**: API 호출 제한을 통한 서비스 안정성 확보

---

## 6. 시스템 아키텍처

### 🏗️ 전체 시스템 구조
```
사용자 → Django Frontend → Django REST API → LangChain Framework
                                    ↓              ↓
                            MySQL DB ←→ LLM (GPT) + RAG System
                                    ↓              ↓
                            User Profile ←→ Vector DB (Pinecone)
                                    ↓              ↓
                            ML Recommendation ←→ Insurance Data
                                    ↓
                            Mock Server (자체 구축 보험료 API)
```

### 🤖 LLM + LangChain + RAG 통합 아키텍처
```
사용자 질의 → LangChain Router → RAG Retrieval (Pinecone)
                    ↓                    ↓
            LLM Processing ←→ Context Augmentation
                    ↓                    ↓
            ML Scoring ←→ Personalized Response
                    ↓                    ↓
        Mock API Call ←→ 실시간 보험료 계산 (Mock)
                    ↓
            Django Response → 사용자 인터페이스
```

### 👤 회원관리 시스템
**필수 정보**
- **아이디**: 로그인 식별자
- **비밀번호**: 암호화 저장 (Django 기본 해시)
- **생년월일**: 보험료 계산 및 위험도 평가

**선택 정보** *(보험 추천 정확도 향상)*
- **자동차 번호**: 차량 정보 자동 조회
- **운전 경력**: 면허 취득일 또는 운전 연수
- **성별**: 보험료 산정 요소
- **직업**: 위험도 평가 요소
- **거주지역**: 지역별 보험료 차등
- **연간 주행거리**: 사용 패턴 분석
- **사고 이력**: 과거 보험 사고 여부
- **차량 정보**: 연식, 배기량, 차종 등
- **보험 가입 이력**: 현재 가입 보험 및 만료일

### 🔄 LLM + RAG + ML 통합 워크플로우
1. **사용자 로그인 및 Django 세션 관리**
2. **사용자 질의 입력 (Django View 처리)**
3. **LangChain을 통한 질의 분석 및 라우팅**
4. **RAG 시스템**: Pinecone에서 관련 보험 약관 검색
5. **LLM 처리**: GPT 모델을 통한 컨텍스트 기반 응답 생성
6. **ML 개인화**: 사용자 프로필 기반 추천 점수 계산
7. **Django Template을 통한 결과 렌더링**

### 🧠 ML 추천 시스템: 협업 필터링 기반
```python
# ML 추천 시스템 구조
현재 사용자 프로필 → 유사 사용자 탐색 → 추천 상품 예측
      ↓                    ↓                ↓
[성별, 나이, 지역,    유사도 계산        해당 유사 사용자들이
운전경력, 차량정보]   (코사인 유사도)     선택한 보험상품들
      ↓                    ↓                ↓
사용자 특성 벡터 ←→ 유사 사용자 그룹 → ML 점수 기반 추천
```

### 📊 ML 알고리즘 세부 구조
**1단계: 사용자 프로필 벡터화**
- 성별, 생년월일(나이), 거주지역, 운전경력, 차량정보 등을 수치 벡터로 변환

**2단계: 유사 사용자 탐색**
- 기존 회원들의 프로필과 코사인 유사도 계산
- 상위 K명의 유사 사용자 선별

**3단계: 협업 필터링 추천**
- 유사 사용자들이 선택한 보험상품 분석
- 각 보험상품별 선택 빈도 및 만족도 점수 계산
- 가중 평균을 통한 추천 점수 산출

### 🔐 사용자 인증 플로우
```
회원가입 → 이메일 인증 → 프로필 입력 (선택) → 로그인 → 서비스 이용
    ↓
필수정보: ID, 비밀번호, 생년월일
    ↓
선택정보: 차량번호, 운전경력, 개인정보 등 (추천 정확도 향상)
```

---

## 7. 주요 기능

### 🔧 관리자 기능 (추가)
- 보험사 약관 DOCX 업로드 및 Pinecone 인덱스 자동 재생성
- 업로드 이력 및 버전 관리 화면
- 개발 단계에서 5개 API KEY 병행 테스트 운영

### 🤖 LLM + LangChain 기반 AI 상담 챗봇
- **LangChain Memory**: 대화 맥락 유지 및 세션 관리
- **Prompt Engineering**: 보험 도메인 특화 프롬프트 템플릿
- **Tool Integration**: CODEF API, 데이터베이스 연동
- **Response Validation**: LLM 응답의 정확성 검증

### 🎯 ML 기반 협업 필터링 추천 시스템
- **사용자 유사도 계산**: 성별, 나이, 거주지역, 운전경력, 차량정보 기반
- **협업 필터링**: 유사한 회원들의 보험 선택 이력 분석
- **추천 점수 산출**: 유사 사용자들이 선택한 보험상품의 가중 평균
- **실시간 학습**: 새로운 사용자 선택 데이터로 모델 지속 업데이트
- **Cold Start 해결**: 신규 사용자 대상 콘텐츠 기반 필터링 병행

### 🔍 ML 데이터 구조
**사용자-보험상품 매트릭스**
```python
# 예시 데이터 구조
User_ID | 성별 | 나이 | 지역 | 경력 | 차량 | 선택상품 | 만족도
--------|------|------|------|------|------|----------|--------
U001    | M    | 30   | 서울 | 5년  | 준중 | 삼성화재 | 4.5
U002    | F    | 28   | 부산 | 3년  | 소형 | 현대해상 | 4.2
U003    | M    | 32   | 서울 | 6년  | 준중 | 삼성화재 | 4.8
...
```

### 🤖 ML + LLM + RAG 융합 추천
1. **ML 1차 필터링**: 유사 사용자 기반 후보 상품 선별
2. **RAG 정보 검색**: 후보 상품들의 상세 약관 정보 추출
3. **LLM 개인화**: 사용자 질의와 상품 정보를 바탕으로 맞춤형 설명 생성
4. **최종 추천**: ML 점수 + LLM 분석을 결합한 종합 추천

### 💳 실시간 견적
- **즉시 계산**: CODEF API를 통한 실시간 보험료 계산
- **비교 분석**: 여러 보험사 상품의 가격 및 혜택 비교
- **시각화**: 직관적인 비교 차트 및 그래프

---

## 8. 개발 일정

### 📅 Phase 1: 기획 및 설계 (1-2주)
- 요구사항 분석
- 시스템 설계 및 DB 스키마 설계
- UI/UX 프로토타입 제작

### 📅 Phase 2: 데이터 수집 및 RAG 시스템 구축 (2-3주)
- 보험사 약관 데이터 크롤링
- 데이터 정제 및 구조화
- **Pinecone 벡터 데이터베이스 구축** (관리자 업로드 및 인덱스 재생성 기능 포함)
- **RAG 파이프라인 개발**

### 📅 Phase 3: LLM + LangChain 백엔드 개발 (3-4주)
- **Django REST API 프레임워크 구축**
- **LangChain 기반 LLM 통합**
- **RAG 시스템과 LLM 연동**
- **ML 협업 필터링 알고리즘 개발**:
  - 사용자 유사도 계산 모델
  - 추천 점수 산출 알고리즘
  - 실시간 학습 파이프라인
- **Mock 서버 구축 및 연동**: 
  - 11개 보험사 실제 요율 시뮬레이션
  - 실제 보험료 계산 로직 구현
  - 환경변수 기반 Mock/Real API 전환 구조
- MySQL 데이터베이스 연결

### 📅 Phase 4: Django 프론트엔드 개발 (2-3주)
- **Django Templates 기반 사용자 인터페이스**
- **Bootstrap 반응형 웹 디자인 적용**
- **AJAX 기반 실시간 챗봇 인터페이스**
- 차트 및 데이터 시각화

### 📅 Phase 5: 테스트 및 배포 (1-2주)
- 통합 테스트 및 버그 수정
- 성능 최적화
- PythonAnywhere 배포

---

## 9. 예상 결과물

### 📱 웹 애플리케이션
- **회원가입/로그인**: 사용자 인증 및 프로필 관리
- **메인 페이지**: 서비스 소개 및 간단 견적
- **상담 페이지**: AI 챗봇 상담 인터페이스
- **비교 페이지**: 보험 상품 상세 비교
- **마이페이지**: 개인 정보 및 보험 이력 관리

### 🗄️ 데이터베이스 스키마
**Users 테이블**
```sql
- user_id (PK): 사용자 고유 ID
- username: 로그인 아이디
- password_hash: 암호화된 비밀번호
- birth_date: 생년월일
- created_at: 가입일시
- updated_at: 정보 수정일시
```

**UserProfiles 테이블** *(ML 학습 데이터)*
```sql
- profile_id (PK): 프로필 고유 ID
- user_id (FK): 사용자 ID 참조
- car_number: 자동차 번호
- driving_experience: 운전 경력 (년)
- gender: 성별
- age: 나이 (생년월일 기반 계산)
- occupation: 직업
- residence_area: 거주지역
- annual_mileage: 연간 주행거리
- accident_history: 사고 이력
- car_info: 차량 정보 (JSON)
- selected_insurance: 선택한 보험상품 ID
- satisfaction_score: 만족도 점수 (1-5)
- selection_date: 보험 선택일
```

**ML_Recommendations 테이블** *(추천 이력)*
```sql
- recommendation_id (PK): 추천 고유 ID
- user_id (FK): 사용자 ID
- recommended_products: 추천 상품 리스트 (JSON)
- ml_scores: ML 추천 점수 (JSON)
- similar_users: 유사 사용자 리스트 (JSON)
- recommendation_date: 추천 생성일
- user_feedback: 사용자 피드백 (선택, 무시 등)
```

### 📊 성과 지표
- **ML 추천 정확도**: 유사 사용자 기반 추천의 정확성 (목표: 85% 이상)
- **사용자 만족도**: 추천 보험상품에 대한 만족도 (목표: 4.2/5.0 이상)
- **추천 다양성**: 추천 상품의 다양성 지수 측정
- **응답 속도**: LLM+RAG+ML 통합 응답 시간 (목표: 5초 이내)
- **Cold Start 해결률**: 신규 사용자 대상 추천 성공률 (목표: 75% 이상)

---

## 10. 기대 효과

### 💼 비즈니스 가치
- **고객 편의성 향상**: 복잡한 보험 비교 과정 단순화
- **시간 절약**: 24/7 AI 상담으로 즉시 정보 제공
- **투명성 증대**: 명확한 약관 설명 및 비교 정보

### 🚀 기술적 성과
- **LLM 애플리케이션 개발**: OpenAI GPT 모델의 실무 활용 경험
- **LangChain 프레임워크**: LLM과 외부 도구 통합 기술 습득
- **RAG 시스템 구현**: 벡터 데이터베이스와 검색 증강 생성 기술
- **Django 풀스택 개발**: REST API부터 프론트엔드까지 통합 개발
- **ML 추천 시스템**: Scikit-learn 기반 개인화 알고리즘 구현
- **대용량 텍스트 처리**: 벡터 임베딩 및 유사도 검색 최적화

### 🎓 학습 성과
- **팀 협업**: 실무형 프로젝트 협업 경험
- **전체 개발 프로세스**: 기획부터 배포까지 전 과정 경험
- **AI 서비스 개발**: 실제 사용 가능한 AI 서비스 구축

---

## 11. 향후 발전 방향

### 🔮 서비스 확장
- **모바일 앱 개발**: 네이티브 모바일 애플리케이션
- **다른 보험 상품**: 생명보험, 건강보험 등으로 확장
- **개인화 고도화**: 머신러닝을 통한 추천 알고리즘 개선

### 🛡️ 보안 강화
- **개인정보 보호**: 고객 데이터 암호화 및 보안 강화
- **인증 시스템**: OAuth, JWT 등을 활용한 사용자 인증

---

## 12. 결론

본 프로젝트는 **AI 기술과 실무 비즈니스 요구사항을 결합**한 실용적인 서비스 개발을 목표로 합니다. RAG 기반의 AI 시스템을 통해 복잡한 자동차보험 정보를 사용자 친화적으로 제공하며, 실시간 견적 서비스를 통해 실질적인 가치를 창출할 것입니다.

**팀원 간의 협업과 최신 AI 기술 활용을 통해 완성도 높은 프로덕트를 개발**하여, 실무에서 바로 활용 가능한 서비스를 구현하고자 합니다.

---

## 13. 관리자 기능 및 Pinecone 인덱스 관리

### 🔑 관리자 계정 기능
- **관리자 로그인 시 추가 기능 제공**
  - 각 보험사의 최신 자동차보험 이용약관 업로드 가능 (DOCX 형식)
  - 업로드 시 해당 보험사 기존 Pinecone 인덱스 삭제 및 신규 약관 기반 재생성
  - Pinecone 벡터 임베딩 생성 및 삽입 자동화
  - 약관 리스트 및 관리 화면 제공 (업로드 이력, 파일명, 버전, 등록일 등)

### 🔄 Pinecone 인덱스 운영
- **무료 계정 제한**: Pinecone 무료 계정은 최대 5개 인덱스 사용 가능
- **개발팀 인덱스 분리 전략**:
  - 프로젝트 개발 인원(5명) 각자 API KEY 보유
  - 각자 본인의 API KEY 기반 인덱스 생성/삭제 테스트 진행
  - 운영 환경에서는 통합 API KEY 기반 공용 인덱스 사용
- **보험사별 인덱스 관리 방식**:
  - 보험사별 DOCX 파일 1개로 약관 데이터 관리
  - 관리자 업로드 시 DOCX → 텍스트 추출 → 임베딩 생성 → Pinecone 삽입 자동화
  - 기존 인덱스는 삭제 후 신규로 교체 (최신 약관 유지)

### 🛠 개발 단계 관리자 기능
- 보험사 목록 관리 (등록, 수정, 삭제)
- 약관 업로드 화면 (파일 선택 및 등록 버튼)
- Pinecone 인덱스 관리 대시보드 (생성/삭제 로그 확인)
- API KEY 리스트 관리 (개발자 테스트 용도)
