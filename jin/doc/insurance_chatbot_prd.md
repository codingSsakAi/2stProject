
# PRD – 자동차 보험 추천 챗봇 시스템

## 1. 개요
로그인한 사용자에게 **자동차 보험 추천 및 약관 상담이 가능한 챗봇**을 개발한다.  
PDF 약관 → 텍스트 변환 → Upstage Embedding → Pinecone 저장 → RAG 기반 OpenAI API 챗봇 연결의 일련 과정을 포함한다.  
ML 기반 추천 통계, UI/UX, 음성인식 기능까지 단계적으로 구현한다.

## 2. 작업 환경
- **Python**: 3.10  
- **Django**: 전체 백엔드 구현
- **DB**: MySQL (사용자/관리자 데이터, 추천 이력 저장)  
- **벡터 DB**: Pinecone (1개 인덱스, 무료 요금제 사용)  
- **LangChain**: RAG 파이프라인 구성  
- **LLM**: OpenAI API  
- **Embedding**: Upstage 무료 API  
- **배포 환경**: PythonAnywhere  
- **가상환경**: `.venv`  
- **환경변수**: `.env` (API 키, DB 접속 정보 등)  
- **버전 관리**: Git (branch: `jin`, 단계별 완료 후 `git push`)  
- **.gitignore**: `venv`, `__pycache__`, `.env`, 임시/로그 파일 등 포함

## 3. 최종 결과물
- 로그인한 사용자 전용 **자동차 보험 추천 + 약관 상담 챗봇**
- **기능 구성**:
  1. 회원가입/로그인
  2. PDF 약관 병합 및 텍스트 변환 → Embedding → Pinecone 업로드 (관리자 전용)
  3. RAG 기반 챗봇 (약관 질의응답)
  4. 사용자 옵션 기반 보험 추천
  5. ML 통계 기반 추천 트렌드 제공
  6. 마이페이지(추천 이력/설정)
  7. 선택형 추천 시스템(빠른/표준/상세)
  8. 음성 입력 모드(추후 단계)

## 4. 상세 기능

### 4.1 회원가입 / 로그인
- **필수 입력**: 아이디, 비밀번호, 이름, 생년월일, 성별  
- **옵션 입력**: 자동차 크기, 주행거리, 사고경력, 추가 특약 관심 여부 등  
- **관리자 계정**: 초기 DB 세팅 시 1개 생성
- 비밀번호 해싱 저장 (Django 기본 auth)

### 4.2 PDF 병합 → TXT 변환
- 관리자 전용 메뉴  
- **업로드 방식**: 다중 PDF 업로드 → 1개 PDF로 병합
- **TXT 변환 처리**:
  - 표 포함 텍스트 OCR 처리(EasyOCR)
  - 불필요한 공백 제거, 단락 유지
  - PDF 이미지 내 텍스트 추출
- 변환된 TXT는 `data/txt/{보험사명}/{파일명}.txt`에 저장

### 4.3 Embedding & Pinecone 업로드
- TXT → Upstage Embedding
- Embedding 결과 → Pinecone(단일 인덱스) 업로드
- 기존 동일 약관 데이터가 있으면 **업데이트 모드** 지원
- 관리자 페이지에서 업로드 상태 로그 출력

### 4.4 챗봇 (약관 상담 + 보험 추천)
- RAG:  
  - Pinecone에서 연관 문서 검색  
  - LangChain으로 OpenAI API 연결  
  - 약관 관련 질의응답
- **보험 추천**:
  - 회원가입 옵션 정보 기반  
  - `insurance_mock_server.py`로 보험료 계산 (빠른/표준/상세 모드)
  - 추천 내역은 DB에 저장, 마이페이지에서 조회 가능
- **대화 모드 선택**:
  - `/채팅` → 일반 대화  
  - `/보험추천` → 옵션 기반 추천  
  - `/머신러닝` → 추천 통계 조회  
  - `/종료` → 세션 종료

### 4.5 ML 기반 추천 통계
- **아이디어**: 가입자의 **연령대, 성별, 차량 크기별** 추천 결과를 통계로 시각화
- 실시간 처리 대신 **배치 작업**(예: 하루 1회)으로 백엔드에서 업데이트
- 마이페이지 → “다른 사람들은 이런 보험을 선택했어요” 형태로 표시

### 4.6 UI / UX
- **Bootstrap 100% 적용**
- **카카오톡 유사 레이아웃**
  - 좌측: 채팅 목록
  - 우측: 대화 영역
- 색상: **신뢰감+따뜻함**(블루+오렌지 계열)
- 모바일/PC 반응형 지원
- 관리자 페이지: Django Admin 확장

### 4.7 음성 인식(고도화 단계)
- **Web Speech API**(브라우저 기본) + OpenAI Whisper API 연동 가능
- 텍스트 입력 필드 옆에 **마이크 버튼** 추가
- 대화 모드, 추천, 통계 명령까지 음성 명령으로 지원

## 5. 개발 단계 제안
1. **기본 프로젝트 셋업** (Django, MySQL, .env, git 브랜치 구성)
2. **회원가입/로그인/관리자 계정 생성**
3. **PDF 업로드 → 병합 → TXT 변환**
4. **Embedding → Pinecone 업로드**
5. **RAG 챗봇 구현**
6. **보험 추천 로직 연결 (mock server)**
7. **추천 내역 DB 저장 및 마이페이지**
8. **ML 통계 및 시각화**
9. **UI/UX 개선 (카톡 스타일)**
10. **음성 인식 기능 추가**

## 6. 기술 스택
- **Backend**: Django, Django Rest Framework
- **Frontend**: Bootstrap, jQuery
- **DB**: MySQL, Pinecone
- **AI**: OpenAI API, Upstage Embedding, LangChain
- **OCR**: EasyOCR
- **배포**: PythonAnywhere
- **버전 관리**: Git

## 7. 기대 효과
- RAG 기반 실질적인 약관 상담 가능
- 사용자 맞춤형 보험 추천
- 데이터 기반 추천 트렌드 제공
- 관리자 친화적 약관 업로드 및 관리 기능
- 향후 음성 인터페이스로 확장 가능
